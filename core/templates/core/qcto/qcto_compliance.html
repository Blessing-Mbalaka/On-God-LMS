{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>QCTO Compliance Check | CHIETA</title>
  <link rel="stylesheet" href="{% static 'core/css/dashboard.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      color-scheme: only light;
      --brand-primary: #3d0b56;
      --brand-accent: #6c2ab5;
      --surface: #ffffff;
      --surface-alt: #f7f4ff;
      --border: #e2d9f5;
      --text-main: #111827;
      --text-muted: #475569;
    }

    body {
      margin: 0;
      font-family: "Inter", system-ui, sans-serif;
      background: linear-gradient(135deg, rgba(61, 11, 86, .12) 0%, rgba(16, 24, 50, .08) 60%, rgba(108, 42, 181, .12) 100%);
      color: var(--text-main);
    }

    .dashboard-container {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 250px;
      background: #fff;
      border-right: 1px solid var(--border);
      padding: 24px 18px;
      box-shadow: 4px 0 20px -12px rgba(61, 11, 86, .25);
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 24px 0;
      display: grid;
      gap: 12px;
    }

    .sidebar a {
      text-decoration: none;
      color: var(--text-muted);
      font-weight: 600;
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 8px 10px;
      border-radius: 8px;
      transition: background .2s ease, color .2s ease;
    }

    .sidebar a.active,
    .sidebar a:hover {
      background: rgba(108, 42, 181, .12);
      color: var(--brand-primary);
    }

    .sidebar-footer {
      margin-top: auto;
    }

    .sidebar-footer img {
      width: 100%;
    }

    .content {
      flex: 1;
      padding: 48px clamp(24px, 4vw, 48px);
      display: grid;
      gap: 26px;
    }

    .page-intro {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 18px;
      align-items: center;
    }

    .page-intro h2 {
      margin: 0;
      font-size: clamp(1.75rem, 2.6vw, 2.2rem);
      color: var(--brand-primary);
    }

    .page-intro p {
      margin: 0;
      color: var(--text-muted);
      max-width: 520px;
    }

    .table-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: 0 22px 45px -26px rgba(61, 11, 86, .35);
      overflow: hidden;
    }

    .table-card table {
      width: 100%;
      border-collapse: collapse;
    }

    .table-card thead {
      background: rgba(108, 42, 181, .08);
      text-transform: uppercase;
      letter-spacing: .04em;
      font-size: .78rem;
      color: var(--brand-primary);
    }

    .table-card th,
    .table-card td {
      padding: 14px 16px;
      border-bottom: 1px solid rgba(226, 217, 245, .7);
      vertical-align: top;
    }

    .table-card tbody tr:last-child td {
      border-bottom: none;
    }

    .table-card tbody tr:hover {
      background: var(--surface-alt);
    }

    .assessment-meta {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .assessment-meta small {
      color: var(--text-muted);
    }

    .view-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(108, 42, 181, .1);
      color: var(--brand-accent);
      border: 1px solid rgba(108, 42, 181, .35);
      border-radius: 999px;
      font-weight: 600;
      text-decoration: none;
      transition: background .2s ease, color .2s ease;
    }

    .view-btn:hover {
      background: rgba(108, 42, 181, .18);
    }

    .view-btn.faded {
      color: var(--text-muted);
      border-style: dashed;
      pointer-events: none;
    }

    .compliance-form {
      display: grid;
      gap: 10px;
    }

    .compliance-form textarea {
      border: 1px solid var(--border);
      background: #fff;
      padding: 10px 12px;
      border-radius: 10px;
      font-family: inherit;
      resize: vertical;
      min-height: 72px;
      color: var(--text-main);
    }

    .compliance-form textarea:focus {
      outline: 2px solid rgba(108, 42, 181, .35);
    }

    .decision-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-approve {
      background: #16a34a;
      color: #fff;
    }

    .btn-reject {
      background: #dc2626;
      color: #fff;
    }

    .btn:hover {
      filter: brightness(.95);
    }

    @media (max-width: 920px) {

      .table-card th,
      .table-card td {
        padding: 12px 12px;
      }

      .decision-buttons {
        flex-direction: column;
        align-items: stretch;
      }

      .btn {
        justify-content: center;
      }
    }
  </style>
</head>

<body>
  <div class="dashboard-container">
    <div class="sidebar">
      <div class="graduate-icon">
        <a href="{% url 'qcto_dashboard' %}">
          <img src="{% static 'core/images/logo_simplebbbbbbbbbbbbbb.png' %}" alt="CHIETA Logo">
        </a>
      </div>
      <ul class="sidebar-nav">
        <li><a href="{% url 'qcto_dashboard' %}"
            class="{% if request.resolver_match.url_name == 'qcto_dashboard' %}active{% endif %}"><i
              class="fa fa-tachometer-alt"></i> Dashboard</a></li>
        <li><a href="{% url 'qcto_assessment_review' %}"
            class="{% if request.resolver_match.url_name == 'qcto_assessment_review' %}active{% endif %}"><i
              class="fa fa-check"></i> Final Assessment Review</a></li>
        <li><a href="{% url 'qcto_compliance' %}"
            class="{% if request.resolver_match.url_name == 'qcto_compliance' %}active{% endif %}"><i
              class="fa fa-clipboard-check"></i> Compliance & Reports</a></li>
        <li><a href="{% url 'qcto_archive' %}"
            class="{% if request.resolver_match.url_name == 'qcto_archive' %}active{% endif %}"><i
              class="fa fa-archive"></i> Assessment Archive</a></li>
      </ul>
      <div class="sidebar-footer">
        <a href="{% url 'logout' %}" class="view-btn" style="width:100%; justify-content:center; margin-bottom:18px;">
          <i class="fa fa-sign-out-alt"></i> Log Out
        </a>
        <img src="{% static 'core/images/rb_2149331949.png' %}" alt="Sidebar Art">
      </div>
    </div>

    <div class="content">
      <div class="page-intro">
        <div>
          <h2>QCTO Compliance Checks</h2>
          <p>Review assessor submissions, record QCTO notes, and approve or return papers for further refinement.</p>
        </div>
      </div>

      <div class="table-card">
        <table>
          <thead>
            <tr>
              <th scope="col">Assessment</th>
              <th scope="col">Qualification</th>
              <th scope="col">Institution Notes</th>
              <th scope="col">QCTO Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for a in assessments %}
            <tr>
              <td>
                <div class="assessment-meta">
                  <strong>{{ a.eisa_id }}</strong>
                  <small>{{ a.created_at|date:"M j, Y H:i" }}</small>
                  <div>
                    {% if a.paper_type == 'randomized' %}
                    <!-- <a href="{% url 'assessor_randomized_snapshot' a.id %}" class="view-btn"><i class="fas fa-eye"></i> -->
                    View Randomised</a>
                    <a href="{% url 'download_randomized_pdf' a.id %}?format=docx" class="view-btn"><i
                        class="fas fa-download"></i> Download Word</a>
                    {% elif a.paper_link %}
                    <!-- <a href="{% url 'load_saved_paper' a.paper_link.pk %}" class="view-btn"><i class="fas fa-eye"></i> View Paper</a> -->
                    {% elif a.file %}
                    <a href="{{ a.file.url }}" target="_blank" class="view-btn"><i class="fas fa-download"></i> Download
                      Paper</a>
                    {% else %}
                    <span class="view-btn faded"><i class="fas fa-eye-slash"></i> No paper available</span>
                    {% endif %}
                  </div>
                </div>
              </td>
              <td>
                <div class="assessment-meta">
                  <strong>{{ a.qualification|default:"-" }}</strong>
                  <small>Paper: {{ a.paper|default:"-" }}</small>
                  <small>Status: {{ a.status }}</small>
                </div>
              </td>
              <td>
                <div class="assessment-meta">
                  <strong>Assessor Comment</strong>
                  <small>{{ a.comment|default:"No comments supplied." }}</small>
                </div>
              </td>
              <td>
                <form method="post" action="{% url 'qcto_compliance' %}" class="compliance-form">
                  {% csrf_token %}
                  <input type="hidden" name="eisa_id" value="{{ a.eisa_id }}">
                  <textarea name="qcto_notes" rows="3"
                    placeholder="Capture QCTO notes or conditions...">{{ a.qcto_notes }}</textarea>
                  <div class="decision-buttons">
                    <button type="submit" name="decision" value="approve" class="btn btn-approve"><i
                        class="fas fa-check"></i> Approve</button>
                    <button type="submit" name="decision" value="reject" class="btn btn-reject"><i
                        class="fas fa-undo"></i> Return</button>
                  </div>
                </form>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-center py-4">No assessments require compliance review.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>

</html>